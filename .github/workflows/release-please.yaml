on:\n  push:\n    branches:\n      - main\nname: Run Release Please\njobs:\n  release-please:\n    name: Release Please Manifest\n    runs-on: ubuntu-latest\n    outputs:\n      paths_released: ${{ steps.release.outputs.paths_released }}\n      tag_name: ${{ steps.release.outputs.tag_name }}\n      releases_created: ${{ steps.release.outputs.releases_created }}\n    steps:\n      - name: Release Please\n        uses: google-github-actions/release-please-action@v3\n        id: release\n        with:\n          command: manifest\n          token: ${{ secrets.GITHUB_TOKEN }}\n          default-branch: main\n\n  publish:\n    if: needs.release-please.outputs.releases_created\n    name: Publish\n    needs:\n      - release-please\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout Repository\n        uses: actions/checkout@v3\n\n      - name: Check Workflow Existence\n        id: check-workflow-existence\n        run: |\n          if [ -f .github/workflows/build_image.yml ]; then\n            echo \"build_image_workflow_exists=true\" >> \"$GITHUB_OUTPUT\"\n          fi\n\n          if [ -f .github/workflows/build_artifact.yml ]; then\n            echo \"build_artifact_workflow_exists=true\" >> \"$GITHUB_OUTPUT\"\n          fi\n\n      - name: Invoke Container Image Publish Workflow\n        if: steps.check-workflow-existence.outputs.build_image_workflow_exists\n        uses: benc-uk/workflow-dispatch@v1\n        with:\n          workflow: build_image.yml\n          inputs: '{\"from\": \"${{ needs.release-please.outputs.tag_name }}\", \"on_premises\": \"*\"}'\n\n      - name: Invoke Artifact Publish Workflow\n        if: steps.check-workflow-existence.outputs.build_artifact_workflow_exists\n        uses: benc-uk/workflow-dispatch@v1\n        with:\n          workflow: build_artifact.yml\n          inputs: '{\"from\": \"${{ needs.release-please.outputs.tag_name }}\", \"targets\": \"*\"}'\n